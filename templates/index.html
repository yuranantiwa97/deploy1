<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Sistem Rekomendasi Restoran Yogyakarta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f5f6fa; }
    .container { max-width: 850px; }
    .result-card { background: #fff; border-radius: 10px; padding: 1.2rem; margin-bottom: 1.2rem; box-shadow: 0 2px 6px #d2d6e3; }
    .fw-semibold { font-weight: 600; }
    .filter-label { font-weight: 500; margin-bottom: 2px; }
    .rating-star { color: #ffc107; }
  </style>
</head>
<body>
  <nav class="navbar navbar-light bg-primary mb-4">
    <div class="container">
      <span class="navbar-brand mb-0 h1 text-white">Rekomendasi Restoran Yogyakarta</span>
    </div>
  </nav>
  <div class="container pb-4">
    <div class="card shadow-sm p-4 mb-4">
      <h5 class="mb-3">Filter Rekomendasi</h5>
      <form method="GET" action="/">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="filter-label">Nama Restoran</label>
            <input type="text" class="form-control" name="nama" placeholder="Cari nama restoran..." value="{{ request.args.get('nama', '') }}">
          </div>
          <div class="col-md-6">
            <label class="filter-label">Jenis Makanan</label>
            <select class="form-select" name="jenis">
              <option value="">Semua Jenis</option>
              {% for jenis in jenis_list %}
                <option value="{{ jenis }}" {% if request.args.get('jenis', '')==jenis %}selected{% endif %}>{{ jenis }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label class="filter-label">Harga (Rp): <span id="harga-range"></span></label>
            <input type="range" class="form-range" name="harga_min" min="{{ harga_min }}" max="{{ harga_max }}" value="{{ harga_min_req or harga_min }}" step="1000" id="rangeHargaMin">
            <input type="range" class="form-range" name="harga_max" min="{{ harga_min }}" max="{{ harga_max }}" value="{{ harga_max_req or harga_max }}" step="1000" id="rangeHargaMax">
          </div>
          <div class="col-md-6">
            <label class="filter-label">Rating: <span id="rating-range"></span></label>
            <input type="range" class="form-range" name="rating_min" min="{{ rating_min }}" max="{{ rating_max }}" value="{{ rating_min_req or rating_min }}" step="0.1" id="rangeRatingMin">
            <input type="range" class="form-range" name="rating_max" min="{{ rating_min }}" max="{{ rating_max }}" value="{{ rating_max_req or rating_max }}" step="0.1" id="rangeRatingMax">
          </div>
          <div class="col-md-6">
            <label class="filter-label">Cluster</label>
            <select class="form-select" name="cluster">
              <option value="">Semua Cluster</option>
              {% for cluster in clusters %}
                <option value="{{ cluster }}" {% if request.args.get('cluster', '')==cluster|string %}selected{% endif %}>Cluster {{ cluster }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-12 text-end mt-2">
            <button type="submit" class="btn btn-primary">Tampilkan Rekomendasi</button>
          </div>
        </div>
      </form>
    </div>
    {% if hasil is defined %}
      <h5>Hasil Rekomendasi ({{ hasil|length }})</h5>
      {% if hasil %}
        <div class="table-responsive mb-5">
          <table class="table table-striped table-hover align-middle">
            <thead>
              <tr>
                <th>No</th>
                <th>Nama Restoran</th>
                <th>Jenis Makanan</th>
                <th>Harga (Rp)</th>
                <th>Rating</th>
                <th>Cluster</th>
              </tr>
            </thead>
            <tbody>
              {% for row in hasil %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ row['Nama Restoran'] }}</td>
                <td>{{ row['Preferensi Makanan'] }}</td>
                <td>{{ "{:,}".format(row['Harga Rata-Rata Makanan di Toko (Rp)']) }}</td>
                <td>
                  {% set rating_int = row['Rating Toko']|int %}
                  {% for i in range(rating_int) %}
                    <span class="rating-star">&#9733;</span>
                  {% endfor %}
                  <span class="ms-1 small">({{ row['Rating Toko'] }})</span>
                </td>
                <td>{{ row['cluster_kmeans'] }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-warning">Tidak ada restoran yang cocok dengan filter.</div>
      {% endif %}
    {% endif %}
  </div>
  <script>
    // Script untuk update tampilan nilai range harga & rating
    document.addEventListener('DOMContentLoaded', function() {
      let hargaMin = document.getElementById('rangeHargaMin');
      let hargaMax = document.getElementById('rangeHargaMax');
      let ratingMin = document.getElementById('rangeRatingMin');
      let ratingMax = document.getElementById('rangeRatingMax');
      let hargaLabel = document.getElementById('harga-range');
      let ratingLabel = document.getElementById('rating-range');

      function updateHarga() {
        hargaLabel.textContent = hargaMin.value + ' - ' + hargaMax.value;
      }
      function updateRating() {
        ratingLabel.textContent = ratingMin.value + ' - ' + ratingMax.value;
      }
      if (hargaMin && hargaMax) {
        hargaMin.oninput = updateHarga;
        hargaMax.oninput = updateHarga;
        updateHarga();
      }
      if (ratingMin && ratingMax) {
        ratingMin.oninput = updateRating;
        ratingMax.oninput = updateRating;
        updateRating();
      }
    });
  </script>
</body>
</html>
